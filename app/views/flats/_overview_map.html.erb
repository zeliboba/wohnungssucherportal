<script type="text/javascript">

function initialize() {
  
  // set up new map
  var mapOptions = {
    zoom: 13,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    scaleControl: true
  };  
  map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
  
  // initialize one infobox
  var infowindow = new google.maps.InfoWindow({
    	content: 'empty at the start'
    });		

  // set center
  var geocoder = new google.maps.Geocoder();

  centerMap(map, geocoder, <%=raw current_user.city.to_json %>);  
  
  // pass server data to js
  var favoritePlaces = <%=raw current_user.favorite_places.to_json %>;
  var addresses      = [<%=raw @flats.map(&:to_json).join(', ') %>];
  
  placeMarkers(favoritePlaces, 'green', infowindow);
  var flatMarkers = placeMarkers(addresses, 'red', infowindow);

  initMarkerHighlighting(flatMarkers);
}
</script>

<div id="map_canvas"></div>
